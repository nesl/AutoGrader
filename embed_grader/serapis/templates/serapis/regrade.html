{% extends 'serapis/base_sidebar.html' %}
{% load staticfiles %}
{% load guardian_tags %}
{% load bootstrap3 %}

{% block sidebar-content %}
  <!-- SIDEBAR USER TITLE -->
  <div class="profile-usertitle">
    <div class="profile-usertitle-name">
      Regarding Interface
    </div>
    <div class="profile-usertitle-job">
      {{ assignment.name }}
    </div>
  </div>
  <!-- END SIDEBAR USER TITLE -->
  <!-- SIDEBAR MENU -->
  <div class="profile-usermenu">
    <ul class="nav nav-bar">
      <li>
        <a href="{% url 'homepage' %}">Courses</a>
      </li>
      {% get_obj_perms request.user for course as "course_perms" %}
      {% if "view_membership" in course_perms %}
      <li>
        <a href="{% url 'membership' course.id %}">Students</a>
      </li>
      {% endif %}
      {% if perms.serapis.view_hardware_type %}
      <li>
        <a data-toggle="collapse"
        data-target="#submenu1" aria-expanded="false">Submissions</a>
        <ul class="nav collapse" id="submenu1" role="menu" aria-labelledby="btn-1">
          <li><a href="{% url 'submissions_full_log' %}">My Submissions</a></li>
          <li><a href="{% url 'student_submission_full_log' %}">Student Submissions</a></li>
        </ul>
      </li>
      <li><a href="{% url 'testbed-type-list' %}">Testbed Types</a></li>
      <li><a href="{% url 'hardware-type-list' %}">Hardware Types</a></li>
      {% else %}
      <li class="active"><a href="{% url 'submissions_full_log' %}">Submissions</a></li>
      {% endif %}
    </ul>
  </div>
  <!-- END MENU -->
{% endblock %}

{% block main-content %}
  <div class="main-content">
    <style>
      form input[type='radio'] {
        display: inline-block;
      }
    </style>
    <div class="top-buffer">
      <ol class="breadcrumb">
        <li><a href="{% url 'homepage' %}">Courses</a></li>
        <li><a href="{% url 'course' course.id %}">{{ course.course_code }}</a></li>
        <li><a href="{% url 'assignment' assignment.id %}">{{ assignment.name }}</a></li>
        <li>Regrading interface</li>
      </ol>
    </div>

    {% if previous_commit_result %}
      <div class="alert alert-success alert-dismissable alert-link">
        <button class="close" type="button" data-dismiss="alert" aria-hidden="true">x</button>
        {{previous_commit_result.num_successful_submissions}} submission(s) and
        {{previous_commit_result.num_successful_task_grading_status}} task-grading status have been updated.
      </div>
    {% endif %}
    <h3 class="page-header">Regrade interface</h3>
    <h5>Course: {{course.course_code}} {{course.name}}</h5>
    <h5>Assignment: {{assignment.name}}</h5>
    <hr/>
    
    <form action="." method="post" class="form">
      {% csrf_token %}
      {% bootstrap_form form %}
      <input class="btn btn-primary" type="submit" value="Submit" />&nbsp;
      <a class="btn btn-default" href="javascript:history.back()" />Back</a>
    </form>

    <script>
      $('#id_author_choice').width(200);
      $('#id_author_choice').css('display', 'inline-block');
      $('#id_author_scope').children().last().css('display', 'inline-block');
      $('#id_author_scope').append('<div id="id_author_scope_select" style="display:inline-block">, and the author is </div>');
      $('#id_author_choice').appendTo('#id_author_scope_select');

      $('#id_submission_range').width(400);
      $('#id_submission_range').css('display', 'inline-block');
      $('#id_submission_scope').children().last().css('display', 'inline-block');
      $('#id_submission_scope').append('<div id="id_submission_scope_range" style="display:inline-block">: </div>');
      $('#id_submission_range').appendTo('#id_submission_scope_range');

      $('.form-group').slice(2, 4).remove();

      function onAuthorScopeChange() {
        if ($("#id_author_scope_1:checked").is(":checked"))
          $('#id_author_scope_select').css('visibility', 'visible');
        else
          $('#id_author_scope_select').css('visibility', 'hidden');
      }
      
      function onSubmissionScopeChange() {
        if ($("#id_submission_scope_1:checked").is(":checked"))
          $('#id_submission_scope_range').css('visibility', 'visible');
        else
          $('#id_submission_scope_range').css('visibility', 'hidden');
      }

      onAuthorScopeChange();
      onSubmissionScopeChange();

      $('input[type=radio][name=author_scope]').change(onAuthorScopeChange);
      $('input[type=radio][name=submission_scope]').change(onSubmissionScopeChange);
    </script>
  </div>
{% endblock %}
