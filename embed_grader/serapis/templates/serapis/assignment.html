{% extends 'serapis/base_sidebar.html' %}
{% load staticfiles %}
{% load guardian_tags %}

{% block sidebar-content %}
    <!-- SIDEBAR USER TITLE -->
    <div class="profile-usertitle">
        <div class="profile-usertitle-name">
            {{ course.course_code }}
        </div>
        <div class="profile-usertitle-job">
            {{ assignment.name }}
        </div>
    </div>
    <!-- END SIDEBAR USER TITLE -->
    <!-- SIDEBAR MENU -->
    <div class="profile-usermenu">
        <ul class="nav nav-bar">
            <li>
                <a href="{% url 'homepage' %}">Courses</a>
            </li>
            <li>
                <a href="{% url 'submissions_full_log' %}">Submissions</a>
            </li>
            {% get_obj_perms request.user for course as "course_perms" %}
            {% if "view_membership" in course_perms %}
            <li>
                <a href="{% url 'membership' course.id %}">Students</a>
            </li>
            {% endif %}
            {% if perms.serapis.view_hardware_type %}
            <li>
                <a href="{% url 'testbed-type-list' %}">Testbed Types</a>
            </li>
            <li>
                <a href="{% url 'hardware-type-list' %}">Hardware Types</a>
            </li>
            {% endif %}
        </ul>
    </div>
    <!-- END MENU -->
{% endblock %}

{% block main-content %}
<div class="main-content">
    <div class="top-buffer">
    <ol class="breadcrumb">
        <li><a href="{% url 'homepage' %}">Courses</a></li>
        <li><a href="{% url 'course' course.id %}">{{course.course_code}}</a></li>
        <li class="active">{{ assignment.name }}</a></li>
    </ol>

    </div>

    <h2 class="page-header">Assignment - {{ assignment.name }}</h2>

    <h3>Description</h3>
    <p>{{ assignment.problem_statement|linebreaks }}</p>
    <h4>Input description</h4>
    <p>{{ assignment.input_statement|linebreaks }}</p>
    <h4>Output description</h4>
    <p>{{ assignment.output_statement|linebreaks }}</p>
    <hr/>

    <br>
    <h3>Tasks (Sample: {{public_points}} points. Total: {{total_points}} points)</h3>
    <div class="table-responsive">
      <table class="table table-striped table-hover table-sm">
          <tr>
            <thead class="thead-default">
              <th>Task</th>
              {% get_obj_perms request.user for course as "course_perms" %}
              {% if "modify_assignment" in course_perms %}
                <th>Status</th>
              {% endif %}
              <th>Points</th>
              <th>Description</th>
              <th>Test Input</th>
              {% get_obj_perms request.user for course as "course_perms" %}
              {% if "modify_assignment" in course_perms %}
                <th>Grading Script</th>
                <th>Edit</th>
              {% endif %}
            <thead>
          </tr>
          {% for task in tasks %}
            {% get_obj_perms request.user for course as "course_perms" %}
            {% if "modify_assignment" not in course_perms %}
            <!-- for students -->
              {% if task.get_mode_display != "Hidden" or now > assignment.deadline %}
              <tr>
                  <td style="width:20%;">{{ task.brief_description }}</td>
                  <td style="width:10%;">{{ task.points }}</td>
                  <td style="width:45%;text-align:left">{{ task.description }}</td>
                  {% if task.get_mode_display == "Public" or now > assignment.deadline %}
                    <td style="width:25%;">
                      <a href="{{ MEDIA_URL }}{{ task.test_input.url }}" class="btn btn-primary"
                      style="font-size: 12px; background:white; color:SteelBlue; border-color:SteelBlue">
                      <span class="glyphicon glyphicon-download-alt"></span>&nbsp;Download
                    </td>
                  {% else%}
                    <td>N/A (Hidden)</td>
                  {% endif %}
              </tr>
              {% endif %}
            {% else %}
            <!-- for instructors -->
            <tr>
                <td style="width:20%;">{{ task.brief_description }}</td>
                <td style="width:10%">{{ task.get_mode_display }}</td>
                <td style="width:10%;">{{ task.points }}</td>
                <td style="width:30%; text-align:left">{{ task.description }}</td>
                <td style="width:10%;">
                  <a href="{{ MEDIA_URL }}{{ task.test_input.url }}" class="btn btn-primary"
                  style="font-size: 12px; background:white; color:SteelBlue; border-color:SteelBlue">
                  <span class="glyphicon glyphicon-download-alt"></span>&nbsp;Download
                </td>
                <td style="width:10%;">
                  <a href="{{ MEDIA_URL }}{{ task.grading_script.url }}" class="btn btn-primary"
                  style="font-size: 12px; background:white; color:SteelBlue; border-color:SteelBlue">
                  <span class="glyphicon glyphicon-download-alt"></span>&nbsp;Download
                </td>
                <td style="width:10%">
                  <a href="{% url 'modify-assignment-task' task.id %}" class="btn btn-primary"
                  style="font-size: 12px; background:white; color:SteelBlue; border-color:SteelBlue;width:80px">
                  <span class="glyphicon glyphicon-edit"></span>&nbsp;Edit
                </td>
            </tr>
            {% endif %}
          {% endfor %}
      </table>
    </div>
    {% get_obj_perms request.user for course as "course_perms" %}
    {% if "modify_assignment" in course_perms %}
      <a class="btn btn-primary" href="{% url 'create-assignment-task' assignment.id %}">Create New Task</a>
    {% endif %}

    <hr>
    <br>
    <h3>Submission section</h3>
    <hr>
    <p><b>Release time: </b>{{ assignment.release_time }}</p>
    <p><b>Deadline: </b>{{ assignment.deadline }}</p>
    {% get_obj_perms request.user for course as "course_perms" %}
    {% if "modify_course" in course_perms %}
      {% if now < assignment.deadline %}
        <p><b>Time Remaining: </b>{{ time_remaining }}</p>
      {% endif %}
      <form action="." method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ submission_form.as_p }}
          <input class="btn btn-primary" type="submit" value="Submit" />
      </form>
    {% else %}
      {% if now < assignment.deadline %}
      <p><b>Time Remaining: </b>{{ time_remaining }}</p>

      <form action="." method="post" enctype="multipart/form-data">
          {% csrf_token %}
          {{ submission_form.as_p }}
          <input class="btn btn-primary" type="submit" value="Submit" />
      </form>
      {% endif %}
    {% endif %}

    <hr/>
    <br>
    <h3>Recent Submissions</h3>
    {% if not submission_n_detail_short_list %}
        <p>No submissions to this question yet.</p>
    {% else %}
      {% get_obj_perms request.user for course as "course_perms" %}
      {% if "modify_assignment" not in course_perms %}
        <table class="table table-striped table-hover table-sm">
            <tr>
              <thead class="thead-default">
                <th>Status</th>
                <th>Score</th>
                <th>Submission Time</th>
                <th>Detail</th>
                <th>Code</th>
              </thead>
            </tr>
            {% for s in submission_n_detail_short_list %}
                <tr>
                    <td>{{ s.0.get_status_display }}</td>
                    {% if s.2 < public_points %}
                    <td><span class="badge" style="background:darkred; width:80px;">{{ s.2 }} / {{ public_points }}</span></td>
                    {% else %}
                      <td><span class="badge" style="background:green; width:80px;">{{ s.2 }} / {{ public_points }}</span></td>
                    {% endif %}

                    <td>{{ s.0.submission_time }}</td>
                    <td>
                      <a class="btn btn-primary" href="{% url 'submission' s.0.id %}"
                      style="font-size:12px; background:white; width:90px; color:SteelBlue; border-color:SteelBlue">
                      <span class="glyphicon glyphicon-file"></span>&nbsp;Detail
                    </td>
                    <td><a href="{{ MEDIA_URL }}{{ s.0.file.url }}" class="btn btn-primary"
                      style="font-size: 12px; background:white; color:SteelBlue; border-color:SteelBlue">
                      <span class="glyphicon glyphicon-download-alt"></span>&nbsp;Download
                    </td>
                </tr>
            {% endfor %}
        </table>

        <a class="btn btn-primary" href="{% url 'course' course.id %}" style="width:100px;">Back</a>
      {% else %}
        <table class="table table-striped table-hover table-sm">
            <tr>
              <thead class="thead-default">
                <th>Name</th>
                <th>Score</th>
                <th>Submission Time</th>
                <th>Detail</th>
                <th>Code</th>
              </thead>
            </tr>
            {% for s in submission_n_detail_short_list %}
                <tr>
                    <td style="width:20%">{{ s.3 }}</td>
                    {% if s.2 < total_points %}
                    <td><span class="badge" style="background:darkred; width:80px;">{{ s.2 }} / {{ total_points }}</span></td>
                    {% else %}
                      <td><span class="badge" style="background:green; width:80px;">{{ s.2 }} / {{ total_points }}</span></td>
                    {% endif %}
                    <td style="width:25%">{{ s.0.submission_time }}</td>
                    <td style="width:20%">
                      <a class="btn btn-primary" href="{% url 'submission' s.0.id %}"
                      style="font-size:12px; background:white; width:90px; color:SteelBlue; border-color:SteelBlue">
                      <span class="glyphicon glyphicon-file"></span>&nbsp;Detail
                    </td>
                    <td style="width:20%">
                      <a href="{{ MEDIA_URL }}{{ s.0.file.url }}" class="btn btn-primary" style="font-size:12px; background:white; color:SteelBlue; border-color:SteelBlue">
                      <span class="glyphicon glyphicon-download-alt"></span>&nbsp;Download
                    </td>
                </tr>
            {% endfor %}
        </table>

        <a class="btn btn-primary" href="{% url 'modify-assignment' assignment.id %}" style="width:100px;">
          <span class="glyphicon glyphicon-edit"></span>&nbsp; Edit </a>
        <a class="btn btn-primary" href="{% url 'course' course.id %}" style="width:100px; float:right;">Back</a>
      {% endif %}
    {% endif %}
    <br>
<div>
{% endblock %}
