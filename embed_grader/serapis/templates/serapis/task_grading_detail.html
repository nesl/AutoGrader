{% extends 'serapis/base_sidebar.html' %}
{% load staticfiles %}
{% load guardian_tags %}

{% block sidebar-content %}
    <!-- SIDEBAR USER TITLE -->
    <div class="profile-usertitle">
        <div class="profile-usertitle-name">
            Submission
        </div>
        <div class="profile-usertitle-job">
            {{ assignment.name }}
        </div>
    </div>
    <!-- END SIDEBAR USER TITLE -->
    <!-- SIDEBAR MENU -->
    <div class="profile-usermenu">
        <ul class="nav nav-bar">
            <li>
                <a href="{% url 'homepage' %}">Courses</a>
            </li>
            <li class="active">
                <a href="{% url 'submissions_full_log' %}">Submissions</a>
            </li>
            {% get_obj_perms request.user for course as "course_perms" %}
            {% if "view_membership" in course_perms %}
            <li>
                <a href="{% url 'membership' course.id %}">Students</a>
            </li>
            {% endif %}
            {% if perms.serapis.view_hardware_type %}
            <li>
                <a href="{% url 'testbed-type-list' %}">Testbed Types</a>
            </li>
            <li>
                <a href="{% url 'hardware-type-list' %}">Hardware Types</a>
            </li>
            {% endif %}
        </ul>
    </div>
    <!-- END MENU -->
{% endblock %}

{% block main-content %}
    <div class="main-content">
        <div class="top-buffer">
          <ol class="breadcrumb">
              <li><a href="{% url 'homepage' %}">Courses</a></li>
              <li><a href="{% url 'course' course.id %}">{{ course.course_code }}</a></li>
              <li><a href="{% url 'assignment' assignment.id %}">{{ assignment.name }}</a></li>
              <li><a href="{% url 'submission' submission.id %}">submission detail ({{submission.id}})</a></li>
              <li>{{ assignment_task.brief_description }}</li>
          </ol>
        </div>

        <h3 class="page-header">Grading Detail</h3>

        <h5>Student: {{ author.first_name }} {{ author.last_name }}</h5>
        <h5>Submission time: {{ submission.submission_time }}</h5>
        <h5>Submission ID: {{ submission.id }}</h5>
        <h5>Task case: {{ assignment_task.brief_description }}</h5>
        {% if grading.points == assignment_task.points %}
          <h5>Score: <span class="badge" style="background:green; width:80px;">{{ grading.points }} / {{ assignment_task.points }}</span></h5>
        {% else %}
          <h5>Score: <span class="badge" style="background:darkred; width:80px;">{{ grading.points }} / {{ assignment_task.points }}</span></h5>
        {% endif %}
        {% if grading.DUT_serial_output %}
        <a href="{{ MEDIA_URL }}{{ grading.DUT_serial_output.url }}" class="btn btn-primary"
          style="font-size: 12px;background:white; color:SteelBlue; border-color:SteelBlue; width:150px">
          <span class="glyphicon glyphicon-download-alt"></span> &nbsp;DUT Serial Output
        </a>
        {% endif %}
        <hr>
        {% if grading.grading_detail %}
          <h5>Feedback<h5>
          <br>
          <p style="white-space:pre; font-size:13px">{{feedback}}</p>
          <hr>
        {% endif %}

        {% if grading.output_file %}
          <h5>Output File: &nbsp; <a href="{{ MEDIA_URL }}{{ grading.output_file.url }}" class="btn btn-primary"
            style="font-size: 12px;background:white; color:SteelBlue; border-color:SteelBlue;">
            <span class="glyphicon glyphicon-download-alt"></span> &nbsp;Download
          </a></h5>

          <!-- Generating Waveform -->
          <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
          <script src="https://www.amcharts.com/lib/3/serial.js"></script>
          <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
          <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all"/>
          <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
          <div id="waveform3" style="width:100%; height:300px;"></div>
          <div id="waveform4" style="width:100%; height:300px;"></div>
          <div id="waveform0" style="width:100%; height:300px;"></div>
          <div id="waveform1" style="width:100%; height:300px;"></div>
          <div id="waveform2" style="width:100%; height:300px;"></div>

          <script type="text/javascript">
            {% autoescape off %}
            var plot_pack = {{ js_plot_pack_string }};
            {% endautoescape %}

            charts = []
            for (var cid = 0; cid < plot_pack.data.length; cid++) {
              waveform_data = [];
              for (var i = 0; i < plot_pack.data[cid].length; i++){
                waveform_data.push({
                  "tick": plot_pack.time[i],
                  "value": plot_pack.data[cid][i]
                });
              }

              gid = "g" + cid;
              charts[cid] = AmCharts.makeChart("waveform" + cid, {
                "type": "serial",
                "titles": [{"text": plot_pack.labels[cid]}],
                "theme": "light",
                "autoMarginOffset": 25,
                "dataProvider": waveform_data,
                "graphs": [{
                  "id": gid,
                  "balloonText": "[[tick]]<br><b>[[value]]</b>",
                  "type": "step",
                  "lineThickness": 2,
                  "bullet": "square",
                  "bulletAlpha": 0,
                  "bulletSize": 4,
                  "bulletBorderAlpha": 0,
                  "valueField": "value"
                }],
                "chartScrollbar": {
                  "graph": gid,
                  "gridAlpha": 0,
                  "color": "#888888",
                  "scrollbarHeight": 55,
                  "backgroundAlpha": 0,
                  "selectedBackgroundAlpha": 0.1,
                  "selectedBackgroundColor": "#888888",
                  "graphFillAlpha": 0,
                  "autoGridCount": true,
                  "selectedGraphFillAlpha": 0,
                  "graphLineAlpha": 1,
                  "graphLineColor": "#c2c2c2",
                  "selectedGraphLineColor": "#888888",
                  "selectedGraphLineAlpha": 1
                },
                "chartCursor": {
                  "fullWidth":true,
                  "cursorAlpha": 0.05,
                  "graphBulletAlpha": 1
                },
                "categoryField": "tick",
                "categoryAxis": {
                  "gridAlpha": 0
                },
                "export": {
                  "enabled": true
                }
              });

              //function zoomChart() {
              //  charts[cid].zoomToIndexes(0, 20);
              //}
              //charts[cid].addListener("dataUpdated", zoomChart);
            }
          </script>

          <hr>
        {% endif %}
    </div>

{% endblock %}
